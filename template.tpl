___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Sentry",
  "brand": {
    "id": "github.com_omrilotan",
    "displayName": "omrilotan",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQsAAAD6CAYAAAC27GJaAAAACXBIWXMAAAsSAAALEgHS3X78AAAPaklEQVR42u2d33EaWRNHf97ad5SABFUKAByBxhGYjUDjCKSNwOMIFkdgFMFKESyKYFEAVCFIQIpA3wNXX6m82Pj27bkzw5zztrUGhhH3TN8/3f3u5eVFAACH+I1bAADIAgCQBQAgCwBAFgCALAAAWQAAIAsAQBYAgCwAAFkAALIAAGQBAMgCAABZAACyAABkAQDIAgCQBQAgCwBAFgAAyAIAkAUAIAsAQBYAgCwAAFkAALIAAEAWAIAsAABZAACyAABkAQDIAgCQBQAAsgAAZAEAyAIAkAUAIAsAQBYAgCwAAJAFACALAEAWAIAsAABZAACyAABkAQCALAAAWQAAsgAAZAEAyAIAkAUAIAsAAGQBADH8zi2A89OzE0kTScV3/2stabnabpbcJXj38vLCXeivJEpJU0kfD/zTR0m3kmar7WbNnUMW0B9JFJJmksaGl3+VVK22myfuJLKA4xZFJelz4ts8SCqZniALOF5RzCVdOr3ds6QCYfQHdkP6FVFcOr7lQNIiLI4CsoAjEUXhMPX4kTBuucPIAo6HeY3vfRF2VQBZQMejimtJw5o/ZsZ0BFlAt0VxIqnK8FEDSdfccWQB3aUKAzkHn89Pz0bccmQB3YsqJpKuMn/sjDuPLKB7WAfuvaQ/tTtHEcvHsPMCyAI6ElVMJV0YXvpptd0Uq+1mJmmk3UnNWOb8BZAFHHdUcb/abv4/0EPuh2XRchh2YABZQMujikq2rdL/DPDVdrOQdGN4r4qtVGQB7RbFiTEauPlJjkel+PWLgfJs2QKygITpR+xW6fPPBBPqV1imNVdspSILaGdUUciWKPYrtSlm2hXAiWXOXwZZQPuwhP2PYefjpwSZWN7/IuzMALKAlkQVpWxbpeWv/sOwU3JvnBoBsoAWiMKa/3EfdjtisG6lVvylkAU0jzWrtIx9QdgxsWylXrOViiyg2ahiJFtRm68JVbqvZdtKZTqCLKBBLAPwWQlnIMJip+VzL0NyGyALyBxVFDrc72NvZJBaxn+13VSybaUSXSAL6EhU8fA2/yOR0vAaSvAhC8gcVZSyNQhyS/AKOymWrVTyRpAFZBLFiTGquDNsldYRXQxFCT5kAVmo5Jz/kRBdrLVrZxgd4ZA3giyg3qhiJFupvDobGlciKxVZQOuYG17zqBp3IRLyRi4pwYcsoJ6oopAt/6P2juchGc1Sgo+tVGQBLYkq7h23Sg9hWRMZs5WKLMA3qrDmf2RbFwg7LXeW6IKtVGQBPqKwZpXe1LBVWkd0QTczZAFOuJfKqzG6WEv6Yngp3cyQBSRGFRPZSuU9SWoqtJ/J1qBozl8cWUDawLMwlLRson9HQr+RC7ZS2827l5cX7kI7o4qppL8d3upe0rTu7dM9179Q/Fbv42q7YTpCZAERA82a/7H3iS1p3UDh3MoSEdHNDFlAHCPnNYeBpL/PT8+yHYKimxmygDwDbRmEceP81lfnp2fLjIOxEnkjRwNrFu2fkhRh8Fw4vu2zpOInLQs9r7+SrU7o+xzXB8jiGKVRBmkMHd/2U47j4OenZ2vDdd+vtpuCvzzTEIifmswlTWQ79PQjvmVax7BupdLNjMgCEp/UE+12S7ymJjdyKOR74JoXYiuVyAKyRxnLEKL/Kdtpye+5lLSoeeGTbmZEFtBwlDGSdCtbAd/vedBu4fOppmudK/74+rOkUe5DZUBkcYxRxnq13XitZYxDhFFXMyC6mRFZQEuijCJEGYPEt6ptazWc0PzL8NIPDaTcA5HF0UYZC+0Oc90nvtWgrggjlOCzdDOr+AsjC/AdjE9h8fNr4lvVJgzRzYxpCESF46V25yaqGhcUS9mK57yllkVP61aqpAmLnUQWfRLFa1bplXYZobVkWoaDXIXStldfFz29t1UtUQLdzJBF76jePO0Hkv4KCV5FDcJYhgjmoU3CoJsZsoDDUcVI+7uKjSX9c356dus9GMLALByE4b2FWYmtVGQBP2R+4P9/1K4kXuUsjKcgjJSdkstwsMrzmizTio+U4MsPC5x5o4pC0j8RL3mQVHqfdzCepHyLa7bq+enZUvEnUB/CYTQgsuhlVLEv9P+3hiijVFphnW/OT3a6mRFZwJunZyVbEZi3UcbUsxt6YoTxrN025trpWm7DFCz2GsgbIbI4KlGcKH3Lb6zdWoZbjYcQYVjXMAbaHS1vMrqgBB+yODpSD0a9HRzehXensu+SjL2uJaGb2RVbqUxDjiWqmEj6t4a3dusHEiKfhexp7n+stptbp+tYihJ8RBY9jirq4CJMS5J3BIJwprKf9Jx7PN3DdVimFXQzQxadjyqm8q3K/T1DOSV7vTm4ZRHGQE69SsOWrGUdZc4vDll0VRSeXcUODdR/PbYRw3kO60LshWOOiyW6oJsZsugs1/It23+Ib07CmMtedesvpyhnIbqZIYueRBUjNZMd6SWMSvYtVa/pACX4kEUvqBS/Vfqs9ApXbsLQbsHTUtFq7DEdCIudloF/WWMNUWQBrlFFIdupyOpNef/GhfFmh8QkS6fdkcooLKILZNEJLD/Ux1Cb8rVG5Xul9wPxEMbSuH7hOR2gmxmyOMqoopTtYFO5Z5COlFZ/4lUYRUPrFy5p5OGwl+XziS6QRWtFYd0qvdtX4j4U3p0oLTtUkm4d5vClMdKZNxhd0M0MWbSWa9nyP64PPFlLpTUQGgRhmLcUw4GtyjhgPRY7l6IEH7I4kqhiJFv6+ZdfSfEOU4FPCZc41C73I2XAzozTAa+zD5VsW6lEF8iiVVimH88xrwuHpVKEMXYoiVcaIxuvrVTLwL8kbwRZtCWqKBRftEWSrmMzRh2EcZmyQ5KQRv7ZaSuVbmbIotNYntb31hqWDsKYpSx4Jpx98BqwFtnRzQxZNB5VWPM/kgZOojA8MkQt04pLp+hiIeNWKnkjyKIpUZwYB/2NRzfwIAzrac9xyrZiwtmHJqMLl7UTZAEy/vAtW6UTr9yFMIe3nsP4nLjwZ40uThy+91oNrp0gC4iJKkba31Xsl57q2hWsmToJo1QDGaLh7INFVF5P95lsB8U42YksspI6538tvOsVllszRFNPOVpee+0UXdDNDFm0PqrwLJX32aMdYGKGqDk0D9OB2OhikHCt33/+XLb8GaILZJGFtXzqTrydxyd3KA/TAuuCZ4qwqkyv8ZzWjCnBFw+tAOwRRhl+9F6l8x4kFaml/Y2dvaSEcv7GzmYfPHaFEr4z3cyILPIQQuCJdqvyzw5v+brwmTqfL5V/4a8yXqdndEHeCLJotTCewonGiaQ7L2E4rF9YBuLQesoxrF3ETs0uvQ5Jhc+3yI5uZsgiuzTWq+1mKukPhygjOeErTCcs8ko55dh0dGHNG5nzC0YWTUjjVrsKV6lRxqVDD1FraH5t/O4Lw2AtHe893cyQRSenJlOlF969csgQtQgnZZcg9vPGnpW46WaGLLoqjZmkD4nTkiYyRAcJkrIMutL51lOCD1l0UhgL2fuHvk4L5okLgZbBUxm/75PiD2lNne+5+Rg6WanIomlhLLXbLbFW6h4rYYvPmCE6TIgubg2f5d0UiG5myKKzwliHCMMqjKvExDOLbErjd701DFTv6IJuZsii08J4Pf9gnZKYtzWNBWMuEs4gzJuURfjOlehmhizq5vz0bF5HGbYwJbGuYQyVduLQ8trrTLIY13Q4im5mjpAb8l9RlJK+hf98rcA988whCD/Gv40vfx+kY/ncteJyWZ5X281Jps/6ZK1LeuA6ForPEn6UNCFvhMjiZz+s77uKDbTrB7I+Pz2rHI8n38reOChnDscg4Sm7aHoqErBEiENRgg9Z/ELYuq9U3qs0ll6n/RJ6iJpPHIYnd67Fx9hdkaKOP2hYXKabGbJwjSpGOtxVbCjpn/PTM69K0VPj+kXK2sU8hywM6e6DGnciKpGViiwciRlEV9qlkyc9eRIyRFPyGWaGQWyNLmIjp7qiC7qZIQu3qKJQ/CLY2OPHnbusfgjLY897dHoqEr63NSuVrVRkkRSaSwldxfaQO7rIMhVR/CJn3QeiLPd5TDczZPEaVTTSVWzP0/5Lph+/5YlvWk8wbPEO68zPCIfTctf5QBZHIopGu4rtCXdjF+FM1aYyT0Vip1h1RxeWLVG6mRFZmLqKPauGVfKEfAZrdBE7FbFOeRaZPqfuKK733cx6K4sQVlu6is3CD64OLNFFmWkQW3ulxE5FciRy0c0MWdT+h38Mh6nqeuo9KVNeRVhPiBowxnMQsbKo/elNNzNkEfOjt3YVyzFvtUgs125FYRiY60gpjXP8BhK6mc2RBVHFIe6tTXgMg+uupbKwThGioouMNSWsJfiukUU/oopKtq3SnD+QWClZ1xNaKQtJWbYpw46WpQRf1cet1N96JooT46C/saaFZ5KFLHNpw3eyThFiU71zrgtUytgyAVl0h6lsW6VZfxhhAe4u0wCLOgdhnCIs2vqDaKhlArLoAKXlydNQEZRceRXrDFOENkcWkq2b2aBvFbX6JovoikkhAakJcq0nrOseyJmncNZIzhIp9Kq4b29kYQyfywZ/wOvIp93AeMKwjVOEUQP325L9W6hH9CmyiA2fH2rI/4glx4GmXFOEmIE4bOh+k46OLEy0oVjrsu6B3PYpQg//5siig4xacA29nSI0lLRF+8Kf8DtPjR+HwqGM/KJDAzNlinARcV+qTN99HSmYIuEenCh+jeoJWRwhq+1meX56FvuyC9lPRx4zn1t6XUXma+vVFK5v05A7xjnRoyO3fbq5fZPFsf9xLzoyyI7hSf/Yt8XhXskipCU/CnodTjvRu23WPu6GVPzOwSGqQBY9iS7u+b1DAmUfv3Rfz1lMmY6AkS8tONmLLDJGF08IAwzc1FmDFVm0VxhL7bIGmZLAIZ4lfVptN2Wfb0Kvj3uvtpun1XZTSPpTttLw0C5GNbznvaSJY6tKZNFxaczCD+2TOLiFLHbT06+S3q+2m6LGPjGd4t3Lywt3YQ+h/kXnEossi28haWvUsq+yjK1Q5vQ9lg1VRkMWAMA0BACQBQAAsgAAZAEAyAIAkAUAIAsAQBYAgCwAAJAFACALAEAWAIAsAABZAACyAABkAQCALAAAWQAAsgAAZAEAyAIAkAUAIAsAAGQBAMgCAJAFACALAEAWAIAsAABZAAAgCwBAFgCALAAAWQAAsgAAZAEAyAIAAFkAALIAAGQBAMgCAJAFACALAEAWAADIAgCQBQAgCwBAFgCALAAAWQAAsgAAQBYAgCwAAFkAALIAAGQBAMgCAHrI/wAHsquDxlUaFwAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "Add sentry script to page.\nAfter Sentry init, the custom event \"sentryLoaded\" will be fired.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "appID",
    "displayName": "Sentry Application ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "\\d*"
        ]
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "key",
    "displayName": "Sentry Key",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "version",
    "displayName": "SDK version",
    "simpleValueType": true,
    "defaultValue": "5.23.0"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const callInWindow = require('callInWindow');
const createQueue = require('createQueue');
const injectScript = require('injectScript');

const dataLayerPush = createQueue('dataLayer');

function sentryLoaded() {
  callInWindow(
    'Sentry.init',
    {
      dsn: 'https://' + data.key + '@sentry.io/' + data.appID
    }
  );
  dataLayerPush({ event: 'sentryLoaded' });
  data.gtmOnSuccess();
}

injectScript(
  'https://browser.sentry-cdn.com/' + data.version + '/bundle.min.js',
  sentryLoaded,
  data.gtmOnFailure,
  'sentry'
);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "Sentry.init"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://browser.sentry-cdn.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Trigger
  code: |-
    const mockData = {
      appID: 'SENTRY_ID',
      key: 'SENTRY_KEY',
      version: '1.2.3'
    };

    runCode(mockData);

    assertApi('injectScript').wasCalled();
setup: |-
  mock('injectScript', function(url, onSuccess, onFailure) {
    assertThat(url).isEqualTo('https://browser.sentry-cdn.com/1.2.3/bundle.min.js');
    onSuccess();
  });
  mock('callInWindow', function(method, data) {
    assertThat(method).isEqualTo('Sentry.init');
    assertThat(data.dsn).isEqualTo('https://SENTRY_KEY@sentry.io/SENTRY_ID');
  });
  mock('createQueue', function(name) {
    assertThat(name).isEqualTo('dataLayer');
    return function(item) {
      assertThat(item.event).isEqualTo('sentryLoaded');
    };
  });


___NOTES___

(1) This template loads the Sentry SDK.
(2) Upon success - it calls on init with DSN built from your Key and Application ID.
(3) Finally - it fires a custom event, `sentryLoaded` to be picked up by other tags in your system.

For example, my custom tag configured Sentry dimentions
```
<script>
Sentry.configureScope(function configureSentryScope(scope) {
  scope.setTag('page-type', {{page-type}});
  scope.setTag('pwa-mode', {{pwa-mode}});
});
</script>
```


